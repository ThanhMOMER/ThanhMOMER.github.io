<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£ng Pha Th·ªùi Gian</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
            /* Th√™m margin cho body */
            padding: 10px;
            background-color: #f0f0f0;
        }

        #canvasContainer {
            width: 100%;
            max-width: 960px;
        }

        canvas {
            width: 100%;
            height: auto;
            border: 1px solid black;
            display: block;
        }
    </style>
</head>

<body>
    <div id="canvasContainer">
        <canvas id="timeCanvas" width="3840" height="2160"></canvas>
    </div>
    <script>
        // Thi·∫øt l·∫≠p m√∫i gi·ªù v√† th·ªùi gian hi·ªán t·∫°i
        // const vn_tz = "Asia/Ho_Chi_Minh";
        // const now = new Date('2025-05-29T10:28:00+07:00');
        const now = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Ho_Chi_Minh" }));


        // K√≠ch th∆∞·ªõc canvas
        const img_width = 3840;
        const img_height = 2160;
        /// const - Th√™m margin 4 b√™n
        const margin = 250; // Margin 50px cho 4 b√™n
        const gap = 100;
        const section_height = Math.floor((img_height - margin * 2 - 6 * gap) / 7);
        const section_positions = Array.from({ length: 7 }, (_, i) => margin + i * (section_height + gap));
        const total_height = section_positions[6] + section_height;

        // L·∫•y canvas v√† context
        const canvas = document.getElementById("timeCanvas");
        const ctx = canvas.getContext("2d");

        // M√†u s·∫Øc v√† nh√£n
        const colors = ["#b3e5fc", "#c8e6c9", "#fff9c4", "#ffcdd2"];
        const labels = ["1", "2", "3", "4"];

        // H√†m ƒë·ªãnh d·∫°ng ng√†y gi·ªù
        function formatDateTime(date) {
            return `${date.getDate().toString().padStart(2, "0")}/${(date.getMonth() + 1).toString().padStart(2, "0")} ${date.getHours().toString().padStart(2, "0")}:${date.getMinutes().toString().padStart(2, "0")}`;
        }

        // H√†m v·∫Ω bi·ªÉu t∆∞·ª£ng l·ªãch
        function drawCalendarIcon(x, y) {
            ctx.fillStyle = "#2196F3";
            ctx.fillRect(x, y, 30, 30);
            ctx.fillStyle = "white";
            ctx.font = "bold 20px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("üìÖ", x + 15, y + 15);
        }

        // H√†m v·∫Ω t·ª´ng khung
        function drawTimeSection(y_px, start_time, end_time, colors, sublabels, title, prefix = "") {
            const y = y_px / total_height * (img_height - margin * 2) + margin;
            const h = section_height / total_height * (img_height - margin * 2);

            // V·∫Ω 4 ph·∫ßn ch√≠nh
            for (let i = 0; i < 4; i++) {
                const x0 = margin + (i / 4) * (img_width - margin * 2);
                ctx.fillStyle = colors[i];
                ctx.strokeStyle = "gray";
                ctx.fillRect(x0, y, (img_width - margin * 2) / 4, h);
                ctx.strokeRect(x0, y, (img_width - margin * 2) / 4, h);

                // V·∫Ω nh√£n con
                ctx.fillStyle = "black";
                ctx.font = "bold 42px Arial";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(sublabels[i], x0 + (img_width - margin * 2) / 8, y + h / 2);
            }

            // V·∫°ch "Now"
            const total_sec = (end_time - start_time) / 1000;
            const elapsed_sec = (now - start_time) / 1000;
            const now_pos = margin + Math.max(0, Math.min(1, elapsed_sec / total_sec)) * (img_width - margin * 2);
            ctx.strokeStyle = "red";
            ctx.lineWidth = 6;
            ctx.setLineDash([10, 10]);
            ctx.beginPath();
            ctx.moveTo(now_pos, y);
            ctx.lineTo(now_pos, y + h);
            ctx.stroke();
            ctx.setLineDash([]);

            // M·ªëc chia ch√≠nh
            ctx.fillStyle = "black";
            ctx.font = "bold 24px Arial";
            ctx.textAlign = "center";
            for (let i = 0; i < 5; i++) {
                const frac = i / 4;
                const time_point = new Date(start_time.getTime() + total_sec * frac * 1000);
                const label = formatDateTime(time_point);
                ctx.fillText(label, margin + frac * (img_width - margin * 2), y - 36);
            }

            // // T√™n khung
            // ctx.fillStyle = "black";
            // ctx.font = "bold 39px Arial";
            // ctx.textAlign = "left";
            // ctx.textBaseline = "middle";
            // ctx.fillText(title, margin + 60, y + h / 2 - 10);
            // T√™n khung
            ctx.fillStyle = "black";
            ctx.font = "bold 39px Arial";
            ctx.textAlign = "left";
            ctx.textBaseline = "middle";
            ctx.fillText(title, margin + 260, y - 35); // Ch·ªânh x th√†nh margin, y d·ªãch l√™n tr√™n
        }

        // H√†m ch√≠nh ƒë·ªÉ v·∫Ω
        function drawTimeline() {
            ctx.clearRect(0, 0, img_width, img_height);
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, img_width, img_height);

            // Ti√™u ƒë·ªÅ
            ctx.fillStyle = "red";
            ctx.font = "bold 60px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "top";
            ctx.fillText("B·∫¢NG PHA TH·ªúI GIAN", img_width / 2, margin);

            // C·∫•p 3M
            let start_quarter_month = Math.floor(now.getMonth() / 3) * 3;
            let start_3m = new Date(now.getFullYear(), start_quarter_month, 1, 7);
            let end_3m = new Date(
                start_quarter_month === 9 ? now.getFullYear() + 1 : now.getFullYear(),
                (start_quarter_month + 3) % 12,
                1, 7
            );
            drawTimeSection(section_positions[0], start_3m, end_3m, colors, labels, "C·∫•p 3M");


            // C·∫•p 1M
            let start_1m = new Date(now.getFullYear(), now.getMonth(), 1, 7);
            let end_1m = new Date(now.getFullYear(), now.getMonth() + 1, 1, 7);
            drawTimeSection(section_positions[1], start_1m, end_1m, colors, labels, "C·∫•p 1M");


            // C·∫•p 5D
            let days_back_5d = now.getDate() % 5;
            let start_5d = new Date(now);
            start_5d.setDate(now.getDate() - days_back_5d);
            start_5d.setHours(7, 0, 0, 0);
            let end_5d = new Date(start_5d);
            end_5d.setDate(start_5d.getDate() + 5);
            drawTimeSection(section_positions[2], start_5d, end_5d, colors, labels, "C·∫•p 5D");


            // C·∫•p 3D
            let days_back_3d = now.getDate() % 3;
            let start_3d = new Date(now);
            start_3d.setDate(now.getDate() - days_back_3d);
            start_3d.setHours(7, 0, 0, 0);
            let end_3d = new Date(start_3d);
            end_3d.setDate(start_3d.getDate() + 3);
            drawTimeSection(section_positions[3], start_3d, end_3d, colors, labels, "C·∫•p 3D");


            // C·∫•p W
            let weekday = now.getDay() === 0 ? 7 : now.getDay(); // CN = 0 -> 7
            let start_w = new Date(now);
            start_w.setDate(now.getDate() - weekday + 1);
            start_w.setHours(7, 0, 0, 0);
            let end_w = new Date(start_w);
            end_w.setDate(start_w.getDate() + 7);
            drawTimeSection(section_positions[4], start_w, end_w, colors, labels, "C·∫•p W");


            // 1/4W hi·ªán t·∫°i
            let total_week_duration = 7 * 24 * 60 * 60 * 1000;
            let part_duration = total_week_duration / 4;
            let offset = now.getTime() - start_w.getTime();
            let part_index = Math.floor(offset / part_duration);
            let start_qw = new Date(start_w.getTime() + part_index * part_duration);
            let end_qw = new Date(start_qw.getTime() + part_duration);
            drawTimeSection(section_positions[5], start_qw, end_qw, colors, labels, "1/4W");


            // 1/4 c·ªßa 1/4W hi·ªán t·∫°i
            let sub_part_duration = part_duration / 4;
            let offset_sub = now.getTime() - start_qw.getTime();
            let sub_index = Math.floor(offset_sub / sub_part_duration);
            let start_qqw = new Date(start_qw.getTime() + sub_index * sub_part_duration);
            let end_qqw = new Date(start_qqw.getTime() + sub_part_duration);
            drawTimeSection(section_positions[6], start_qqw, end_qqw, colors, labels, "1/4 c·ªßa 1/4W");


            // Ghi th·ªùi gian hi·ªán t·∫°i
            const current_time_str = `B√¢y gi·ªù l√†: ${formatDateTime(now)}:${now.getSeconds().toString().padStart(2, "0")}`;
            ctx.fillStyle = "black";
            ctx.font = "bold 44px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "bottom";
            // ctx.fillText(current_time_str, img_width / 2, img_height - margin);
            ctx.fillText(current_time_str, img_width / 2, img_height - 1/2*margin);
        }

        // V·∫Ω bi·ªÉu ƒë·ªì
        drawTimeline();
    </script>
</body>

</html>